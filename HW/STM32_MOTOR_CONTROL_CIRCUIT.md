# 🔧 STM32F103 모터 제어 MCU 상세 회로도

> 로봇 청소기 모터 제어부 회로 설계 문서

---

## 📋 목차

- [MCU 핀 할당 요약](#mcu-핀-할당-요약)
- [1. 모터 전류 ADC 회로 (PA0~PA3)](#1-모터-전류-adc-회로-pa0pa3)
- [2. 휠 모터 PWM 드라이버 (PA8~PA11)](#2-휠-모터-pwm-드라이버-pa8pa11)
- [3. 브러시/물걸레 모터 드라이버 (PB6~PB9)](#3-브러시물걸레-모터-드라이버-pb6pb9)
- [4. UART1 메인보드 통신 (PA9/PA10)](#4-uart1-메인보드-통신-pa9pa10)
- [5. UART3 디버그 (PB10/PB11)](#5-uart3-디버그-pb10pb11)
- [6. 상태 LED (PC13)](#6-상태-led-pc13)
- [BOM 요약](#bom-요약)

---

## MCU 핀 할당 요약

```
                            STM32F103C8T6
                          ┌───────┴───────┐
                     VBAT │1            48│ VDD
                     PC13 │2    ○ ○ ○   47│ VSS
                     PC14 │3            46│ PB9  ──▶ 물걸레R PWM
                     PC15 │4            45│ PB8  ──▶ 물걸레L PWM
                     OSC_IN│5            44│ BOOT0
                    OSC_OUT│6            43│ PB7  ──▶ 브러시 PWM2
                     NRST │7            42│ PB6  ──▶ 브러시 PWM1
                     VSSA │8            41│ PB5
                     VDDA │9            40│ PB4
             전류1 ◀─ PA0 │10           39│ PB3
             전류2 ◀─ PA1 │11           38│ PA15
             전류3 ◀─ PA2 │12           37│ PA12
             전류4 ◀─ PA3 │13           36│ PA11 ──▶ 휠R IN2
                     PA4 │14           35│ PA10 ◀── UART1_RX
                     PA5 │15           34│ PA9  ──▶ UART1_TX
                     PA6 │16           33│ PA8  ──▶ 휠L IN1
                     PA7 │17           32│ PB15
                     PB0 │18           31│ PB14
                     PB1 │19           30│ PB13 ──▶ 휠R IN1
                    PB10 │20           29│ PB12 ──▶ 휠L IN2
                    PB11 │21           28│ BOOT1
                     VSS │22           27│ PB2
                     VDD │23           26│ PA15
                          └───────────────┘

     UART3_TX ──▶ PB10
     UART3_RX ◀── PB11
     상태LED  ◀── PC13
```

---

## 1. 모터 전류 ADC 회로 (PA0~PA3)

### 1.1 회로 개요

모터 전류를 션트 저항으로 측정하여 ADC로 읽는 회로입니다.
과전류 감지, 모터 부하 모니터링, 장애물 감지에 사용됩니다.

### 1.2 부품 선정

| 부품 | 규격 | 역할 | 선정 이유 |
|-----|------|------|----------|
| **션트 저항** | 0.1Ω, 1W, 1% | 전류→전압 변환 | 1A당 100mV 출력, 전력 여유 |
| **OP-AMP** | LMV324 (4채널) | 신호 증폭 | Rail-to-Rail, 저전압 동작 |
| **필터 커패시터** | 100nF | 노이즈 제거 | ADC 입력 안정화 |
| **보호 다이오드** | BAV99 | 과전압 보호 | 양방향 클램핑 |

### 1.3 설계 계산

```
최대 측정 전류: 3A (휠 모터)
션트 저항: 0.1Ω
최대 션트 전압: 3A × 0.1Ω = 300mV

OP-AMP 증폭률: 10배 (3.0V 출력 @ 3A)
ADC 기준전압: 3.3V
ADC 분해능: 12bit (4096 단계)

전류 분해능: 3A ÷ 4096 × (3.3V ÷ 3.0V) = 0.8mA/LSB
```

### 1.4 회로도

```
                            모터 전류 ADC 회로 (PA0~PA3)
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                                                                 │
│                          ┌─────────────────────────────────────────────┐       │
│                          │              LMV324 (Quad OP-AMP)           │       │
│                          │                                             │       │
│   ┌────────────────────┐ │  CH1 (PA0 - 휠모터L)                        │       │
│   │                    │ │                                             │       │
│   │   휠 모터 L        │ │         100k      100nF                     │       │
│   │   12V / 0.8A      │ │    ┌────/\/\/──────┤├────┐                  │       │
│   │                    │ │    │                     │                  │       │
│   │   M ──────┬────────┼─┼────┤              ┌──────┴──────┐          │       │
│   │           │        │ │    │   10k        │             │          │       │
│   │      ┌────┴────┐   │ │    ├──/\/\/───┬───┤-    LMV324  │          │       │
│   │      │ R_shunt │   │ │    │          │   │    (1/4)   ├────────────┼──▶ PA0
│   │      │  0.1Ω   │   │ │    │    ┌─────┴───┤+            │   100nF   │       │
│   │      │   1W    │   │ │    │    │         │             │  ─┤├──┐  │       │
│   │      └────┬────┘   │ │    │   ─┴─        └──────┬──────┘       │  │       │
│   │           │        │ │    │   ///               │              │  │       │
│   │          GND       │ │    │   GND               │              │  │       │
│   │                    │ │    │                     │              │  │       │
│   │                    │ │    │              BAV99  │              │  │       │
│   └────────────────────┘ │    │              ┌──────┴──────┐       │  │       │
│                          │    │              │  │/    \│  │       │  │       │
│   ┌────────────────────┐ │    │              │  ├──────┤  │       │  │       │
│   │                    │ │    │         3.3V─┤  │\    /│  ├─GND   │  │       │
│   │   휠 모터 R        │ │    │              └─────────────┘       │  │       │
│   │   12V / 0.8A      │ │    │                                    │  │       │
│   │                    │ │    │                                    │  │       │
│   │   M ──────┬────────┼─┼────┤ (동일 회로)                       │  │       │
│   │      ┌────┴────┐   │ │    │                                    │  │       │
│   │      │  0.1Ω   │   │ │    │                                   ─┴─ │       │
│   │      └────┬────┘   │ │    └─────────────────────────────────▶ PA1 │       │
│   │          GND       │ │                                             │       │
│   └────────────────────┘ │                                             │       │
│                          │  CH3 (PA2 - 메인브러시)                     │       │
│   ┌────────────────────┐ │                                             │       │
│   │   메인 브러시      │ │    (동일 회로)                              │       │
│   │   12V / 0.5A      │ │    └─────────────────────────────────▶ PA2 │       │
│   │   M ──────┬────────┼─┤                                             │       │
│   │      ┌────┴────┐   │ │  CH4 (PA3 - 물걸레)                        │       │
│   │      │  0.1Ω   │   │ │                                             │       │
│   │      └────┬────┘   │ │    (동일 회로)                              │       │
│   │          GND       │ │    └─────────────────────────────────▶ PA3 │       │
│   └────────────────────┘ │                                             │       │
│                          │              LMV324 전원                    │       │
│   ┌────────────────────┐ │         VCC (pin14) ─── 3.3V               │       │
│   │   물걸레 모터      │ │                    ─┤├─ 100nF              │       │
│   │   12V / 0.6A      │ │         GND (pin7)  ─── GND                 │       │
│   │   M ──────┬────────┼─┤                                             │       │
│   │      ┌────┴────┐   │ │                                             │       │
│   │      │  0.1Ω   │   │ │                                             │       │
│   │      └────┬────┘   │ │                                             │       │
│   │          GND       │ │                                             │       │
│   └────────────────────┘ │                                             │       │
│                          └─────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 1.5 상세 회로도 (채널 1개)

```
                    모터 전류 감지 상세 회로 (1채널)
    
    모터 전원 (+12V)
         │
         │
    ┌────┴────┐
    │         │
    │  Motor  │
    │    M    │
    │         │
    └────┬────┘
         │
         ├───────────────────────────────────────────────────────┐
         │                                                       │
    ┌────┴────┐                                                  │
    │         │                                                  │
    │ R_shunt │  0.1Ω, 1W, 1%                                   │
    │         │  (션트 저항)                                     │
    │         │                                                  │
    └────┬────┘                                                  │
         │                                                       │
         │    ┌───────────────────────────────────────────┐     │
         │    │                                           │     │
         │    │   R1          C1                          │     │
         ├────┼──/\/\/────────┤├──────────────────────────┘     │
         │    │   10kΩ       100nF                              │
         │    │                                                  │
         │    │              ┌────────────────────────────┐     │
         │    │              │          LMV324           │     │
         │    │      R2      │         (1/4 채널)        │     │
         │    └────/\/\/─────┤─  (Inverting)            │     │
         │          100kΩ    │                    OUT ───┼─────┐
         │                   │                           │     │
         │         ┌─────────┤+  (Non-Inverting)        │     │
         │         │         │                           │     │
         │        ─┴─        └────────────────────────────┘     │
         │        ///                                           │
         │        GND                                           │
         │                                                      │
        ─┴─                                                     │
        ///                                              ┌──────┴──────┐
        GND                                              │             │
                                                         │    R3       │
                                              ┌──────────┤   1kΩ      │
                                              │          │             │
                                              │          └──────┬──────┘
                                              │                 │
                              ┌───────────────┴───┐             │
                              │                   │             │
                              │   BAV99           │             │
                              │   (Dual Diode)    │             │
                              │                   │             │
                         3.3V─┤──┤◁──┬──▷├────────┼─GND         │
                              │      │            │             │
                              └──────┼────────────┘             │
                                     │                          │
                                     │         C2               │
                                     ├─────────┤├───────────────┤
                                     │        100nF             │
                                     │                          │
                                     │                         ─┴─
                                     │                         ///
                                     │                         GND
                                     │
                                     ▼
                                   PA0 (ADC1_IN0)
                                   STM32F103

    증폭률 계산:
    Gain = 1 + (R2/R1) = 1 + (100k/10k) = 11배
    
    출력 전압 = 션트 전압 × 11
    
    1A 입력 → 0.1V × 11 = 1.1V 출력
    3A 입력 → 0.3V × 11 = 3.3V 출력 (풀스케일)
```

---

## 2. 휠 모터 PWM 드라이버 (PA8~PA11)

### 2.1 드라이버 IC 선정

| 후보 | 전압 | 전류 | 채널 | 보호기능 | 단가 | 선정 |
|-----|:----:|:----:|:----:|---------|-----:|:---:|
| **DRV8833** | 2.7~10.8V | 1.5A/ch | 2 (H-bridge×2) | 과열, 과전류 | 800원 | ⭐ |
| TB6612FNG | 2.5~13.5V | 1.2A/ch | 2 (H-bridge×2) | 과열 | 1,200원 | |
| L298N | 5~35V | 2A/ch | 2 (H-bridge×2) | 없음 | 2,500원 | |
| A4950 | 8~40V | 3.5A | 1 (H-bridge×1) | 과열, 과전류 | 600원 | |

**선정: DRV8833** (듀얼 H-Bridge)
- 이유: 소형, 저전압 드롭, 내장 보호회로, 가격 우수
- 2개 사용하여 좌/우 휠 모터 각각 제어

### 2.2 DRV8833 핀 배치

```
              DRV8833 (HTSSOP-16)
            ┌────────┴────────┐
     nSLEEP │1              16│ VM (모터 전원)
      AOUT1 │2              15│ AOUT2
      BOUT1 │3              14│ BOUT2
    nFAULT │4              13│ GND
       AIN2 │5              12│ AIN1
       BIN2 │6              11│ BIN1
       GND │7              10│ VCC (로직 전원)
       GND │8               9│ GND
            └─────────────────┘
```

### 2.3 회로도

```
                       휠 모터 드라이버 회로 (DRV8833 × 2)
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                      │
│   12V 전원                                 3.3V 로직                                 │
│      │                                        │                                      │
│      │    C1                                  │    C3                               │
│      ├────┤├─────┐                            ├────┤├─────┐                         │
│      │   100μF   │                            │   100nF   │                         │
│      │   25V     │                            │           │                         │
│      │           │                            │           │                         │
│  ┌───┴───────────┴───────────────────────────┴───────────┴────────────────┐        │
│  │                                                                         │        │
│  │                         DRV8833 #1 (휠 모터 L)                          │        │
│  │                                                                         │        │
│  │      VM (16) ◀───────────────────────── 12V                            │        │
│  │                                                                         │        │
│  │      VCC (10) ◀──────────────────────── 3.3V                           │        │
│  │                                                                         │        │
│  │      GND (7,8,9,13) ◀────────────────── GND                            │        │
│  │                                                                         │        │
│  │      nSLEEP (1) ◀──────────────────┬─── 3.3V (항상 활성)                │        │
│  │                                    │    (또는 GPIO로 슬립 제어)          │        │
│  │                         10kΩ       │                                    │        │
│  │      nFAULT (4) ───────/\/\/───────┴─── 3.3V (Open-drain 풀업)         │        │
│  │              │                                                          │        │
│  │              └──────────────────────────▶ PB0 (Fault 감지)             │        │
│  │                                                                         │        │
│  │                                                                         │        │
│  │      AIN1 (12) ◀────────────────────── PA8  (TIM1_CH1, PWM)            │        │
│  │      AIN2 (5)  ◀────────────────────── PB12 (GPIO, 방향)               │        │
│  │                                                                         │        │
│  │      AOUT1 (2) ───┬─────────────────────────────────┐                  │        │
│  │                   │                                 │                  │        │
│  │      AOUT2 (15) ──┼─────────────────┐               │                  │        │
│  │                   │                 │               │                  │        │
│  │                   │    ┌────────────┴───────────────┴──────┐           │        │
│  │                   │    │                                   │           │        │
│  │                   │    │          휠 모터 L                │           │        │
│  │                   │    │         DC 12V, 0.8A              │           │        │
│  │                   │    │            ┌───┐                  │           │        │
│  │                   │    │      M ────┤   ├────              │           │        │
│  │                   │    │            └───┘                  │           │        │
│  │                   │    │              │                    │           │        │
│  │                   │    │         ┌────┴────┐               │           │        │
│  │                   │    │         │ R_shunt │ 0.1Ω ──────▶ PA0 (ADC)   │        │
│  │                   │    │         └────┬────┘               │           │        │
│  │                   │    │              │                    │           │        │
│  │                   │    └──────────────┴────────────────────┘           │        │
│  │                   │                                                     │        │
│  │      BIN1 (11) ◀──┼──── (미사용, GND 연결)                             │        │
│  │      BIN2 (6)  ◀──┼──── (미사용, GND 연결)                             │        │
│  │      BOUT1 (3) ───┼──── (미사용)                                       │        │
│  │      BOUT2 (14) ──┴──── (미사용)                                       │        │
│  │                                                                         │        │
│  └─────────────────────────────────────────────────────────────────────────┘        │
│                                                                                      │
│                                                                                      │
│  ┌─────────────────────────────────────────────────────────────────────────┐        │
│  │                                                                         │        │
│  │                         DRV8833 #2 (휠 모터 R)                          │        │
│  │                                                                         │        │
│  │      VM (16) ◀───────────────────────── 12V                            │        │
│  │      VCC (10) ◀──────────────────────── 3.3V                           │        │
│  │      GND (7,8,9,13) ◀────────────────── GND                            │        │
│  │                                                                         │        │
│  │      nSLEEP (1) ◀────────────────────── 3.3V                           │        │
│  │      nFAULT (4) ────────────────────────▶ PB1 (Fault 감지)             │        │
│  │                                                                         │        │
│  │      AIN1 (12) ◀────────────────────── PB13 (GPIO, PWM대용)            │        │
│  │      AIN2 (5)  ◀────────────────────── PA11 (TIM1_CH4, PWM)            │        │
│  │                                                                         │        │
│  │      AOUT1 (2) ───┬─────────────────────────────────┐                  │        │
│  │      AOUT2 (15) ──┼─────────────────┐               │                  │        │
│  │                   │                 │               │                  │        │
│  │                   │    ┌────────────┴───────────────┴──────┐           │        │
│  │                   │    │          휠 모터 R                │           │        │
│  │                   │    │         DC 12V, 0.8A              │           │        │
│  │                   │    │            ┌───┐                  │           │        │
│  │                   │    │      M ────┤   ├────              │           │        │
│  │                   │    │            └───┘                  │           │        │
│  │                   │    │         ┌────┴────┐               │           │        │
│  │                   │    │         │ R_shunt │ 0.1Ω ──────▶ PA1 (ADC)   │        │
│  │                   │    │         └────┬────┘               │           │        │
│  │                   │    └──────────────┴────────────────────┘           │        │
│  │                                                                         │        │
│  └─────────────────────────────────────────────────────────────────────────┘        │
│                                                                                      │
│                                                                                      │
│   제어 신호 연결 요약:                                                               │
│   ┌─────────────────────────────────────────────────────────────────────┐           │
│   │  휠 모터 L:  PA8  (TIM1_CH1) → AIN1, PB12 (GPIO) → AIN2            │           │
│   │  휠 모터 R:  PA11 (TIM1_CH4) → AIN2, PB13 (GPIO) → AIN1            │           │
│   │                                                                     │           │
│   │  PWM 주파수: 20kHz (가청 범위 외)                                   │           │
│   │  제어 방식: PWM + 방향 GPIO                                         │           │
│   └─────────────────────────────────────────────────────────────────────┘           │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.4 모터 제어 진리표

| AIN1 | AIN2 | 동작 |
|:----:|:----:|------|
| PWM | LOW | 정회전 (속도 = PWM duty) |
| LOW | PWM | 역회전 (속도 = PWM duty) |
| LOW | LOW | Coast (프리휠링) |
| HIGH | HIGH | Brake (단락 제동) |

---

## 3. 브러시/물걸레 모터 드라이버 (PB6~PB9)

### 3.1 드라이버 IC 선정

브러시와 물걸레 모터는 **단방향 회전**만 필요하므로, 더 간단한 구성이 가능합니다.

| 모터 | 전압 | 전류 | 방향 | 드라이버 |
|-----|:----:|:----:|:---:|---------|
| 메인 브러시 | 12V | 0.5A | 단방향 | DRV8833 (Half-bridge) |
| 사이드 브러시 L | 5V | 0.15A | 단방향 | MOSFET (AO3400) |
| 사이드 브러시 R | 5V | 0.15A | 단방향 | MOSFET (AO3400) |
| 물걸레 L | 12V | 0.3A | 단방향 | DRV8833 (Half-bridge) |
| 물걸레 R | 12V | 0.3A | 단방향 | DRV8833 (Half-bridge) |

**선정:**
- 12V 모터: **DRV8833** (1개로 브러시 + 물걸레 2개 제어)
- 5V 모터: **AO3400 N-MOSFET** (Low-side 스위칭)

### 3.2 회로도

```
                    브러시/물걸레 모터 드라이버 회로
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                      │
│   ┌─────────────────────────────────────────────────────────────────────────┐       │
│   │                                                                         │       │
│   │                    DRV8833 #3 (브러시 + 물걸레)                          │       │
│   │                                                                         │       │
│   │      VM (16) ◀───────────────────────── 12V                            │       │
│   │      VCC (10) ◀──────────────────────── 3.3V                           │       │
│   │      GND (7,8,9,13) ◀────────────────── GND                            │       │
│   │      nSLEEP (1) ◀────────────────────── 3.3V                           │       │
│   │      nFAULT (4) ─────────────────────▶ PB2 (Fault 감지)                │       │
│   │                                                                         │       │
│   │      ┌─────────────────────────────────────────────────────────────┐   │       │
│   │      │  채널 A: 메인 브러시 (12V, 0.5A)                             │   │       │
│   │      │                                                             │   │       │
│   │      │  AIN1 (12) ◀──────────────── PB6 (TIM4_CH1, PWM)           │   │       │
│   │      │  AIN2 (5)  ◀──────────────── GND (단방향이므로 LOW 고정)    │   │       │
│   │      │                                                             │   │       │
│   │      │  AOUT1 (2) ────┬────────────────────────────────┐          │   │       │
│   │      │                │                                │          │   │       │
│   │      │  AOUT2 (15) ───┼──────────────┐                 │          │   │       │
│   │      │                │              │                 │          │   │       │
│   │      │                │   ┌──────────┴─────────────────┴────┐     │   │       │
│   │      │                │   │         메인 브러시 모터        │     │   │       │
│   │      │                │   │          DC 12V, 0.5A          │     │   │       │
│   │      │                │   │             ┌───┐              │     │   │       │
│   │      │                │   │       M ────┤   ├────          │     │   │       │
│   │      │                │   │             └───┘              │     │   │       │
│   │      │                │   │          ┌────┴────┐           │     │   │       │
│   │      │                │   │          │ 0.1Ω   │──────▶ PA2│     │   │       │
│   │      │                │   │          └────┬────┘    (ADC)  │     │   │       │
│   │      │                │   └───────────────┴────────────────┘     │   │       │
│   │      └─────────────────────────────────────────────────────────────┘   │       │
│   │                                                                         │       │
│   │      ┌─────────────────────────────────────────────────────────────┐   │       │
│   │      │  채널 B: 물걸레 L (12V, 0.3A) - Half Bridge로 사용           │   │       │
│   │      │                                                             │   │       │
│   │      │  BIN1 (11) ◀──────────────── PB8 (TIM4_CH3, PWM)           │   │       │
│   │      │  BIN2 (6)  ◀──────────────── GND                           │   │       │
│   │      │                                                             │   │       │
│   │      │  BOUT1 (3) ────┬────────────────────────────────┐          │   │       │
│   │      │  BOUT2 (14) ───┼──────────────┐                 │          │   │       │
│   │      │                │              │                 │          │   │       │
│   │      │                │   ┌──────────┴─────────────────┴────┐     │   │       │
│   │      │                │   │         물걸레 모터 L           │     │   │       │
│   │      │                │   │          DC 12V, 0.3A          │     │   │       │
│   │      │                │   │             ┌───┐              │     │   │       │
│   │      │                │   │       M ────┤   ├────          │     │   │       │
│   │      │                │   │             └───┘              │     │   │       │
│   │      │                │   └─────────────────────────────────┘     │   │       │
│   │      └─────────────────────────────────────────────────────────────┘   │       │
│   │                                                                         │       │
│   └─────────────────────────────────────────────────────────────────────────┘       │
│                                                                                      │
│                                                                                      │
│   ┌─────────────────────────────────────────────────────────────────────────┐       │
│   │                                                                         │       │
│   │              물걸레 R + 사이드 브러시 (MOSFET 제어)                      │       │
│   │                                                                         │       │
│   │   ┌─────────────────────────────────────────────────────────────────┐   │       │
│   │   │  물걸레 모터 R (12V, 0.3A) - N-MOSFET 사용                      │   │       │
│   │   │                                                                 │   │       │
│   │   │      12V ──────────────────────────────┐                       │   │       │
│   │   │                                        │                       │   │       │
│   │   │                              ┌─────────┴─────────┐             │   │       │
│   │   │                              │   물걸레 모터 R   │             │   │       │
│   │   │                              │    DC 12V        │             │   │       │
│   │   │                              │      ┌───┐       │             │   │       │
│   │   │                              │  M ──┤   ├──     │             │   │       │
│   │   │                              │      └───┘       │             │   │       │
│   │   │                              └─────────┬─────────┘             │   │       │
│   │   │                                        │                       │   │       │
│   │   │                                        │ D                     │   │       │
│   │   │                        SS34 ┌─────────┴─────────┐             │   │       │
│   │   │                   (Flyback)│         │         │             │   │       │
│   │   │                      │/────┘    ┌────┴────┐    │             │   │       │
│   │   │                      ├─────────┤AO3400   │    │             │   │       │
│   │   │                      │\────┐    │N-MOSFET│    │             │   │       │
│   │   │                            │    │        │ G  │             │   │       │
│   │   │                            │    │  D  G  ├────┼─────┐       │   │       │
│   │   │                            │    │  │  │  │    │     │       │   │       │
│   │   │                            │    │  └──┼──┘    │     │       │   │       │
│   │   │                            │    │     │       │     │       │   │       │
│   │   │                            │    └─────┼───────┘     │ 1kΩ   │   │       │
│   │   │                            │          │ S           │       │   │       │
│   │   │                            │          │            /\/\/    │   │       │
│   │   │                            │         ─┴─           │       │   │       │
│   │   │                            │         ///           │       │   │       │
│   │   │                            │         GND           │       │   │       │
│   │   │                            │                       │       │   │       │
│   │   │                            └───────────────────────┴────────┼──◀── PB9
│   │   │                                                             │   │  (TIM4_CH4)
│   │   │                                  10kΩ                       │   │       │
│   │   │                             ┌───/\/\/────GND                │   │       │
│   │   │                             │    (Pull-down)                │   │       │
│   │   │                             │                               │   │       │
│   │   └─────────────────────────────┴───────────────────────────────┘   │       │
│   │                                                                         │       │
│   │   ┌─────────────────────────────────────────────────────────────────┐   │       │
│   │   │  사이드 브러시 L/R (5V, 0.15A) - 동일 MOSFET 회로               │   │       │
│   │   │                                                                 │   │       │
│   │   │      5V ───────────────────────────────┐                       │   │       │
│   │   │                              ┌─────────┴─────────┐             │   │       │
│   │   │                              │  사이드브러시 L   │             │   │       │
│   │   │                              │   DC 5V, 0.15A   │             │   │       │
│   │   │                              └─────────┬─────────┘             │   │       │
│   │   │                                        │                       │   │       │
│   │   │                              ┌─────────┴─────────┐             │   │       │
│   │   │                              │      AO3400       │             │   │       │
│   │   │                              │     N-MOSFET      │             │   │       │
│   │   │                              └─────────┬─────────┘             │   │       │
│   │   │                                        │                       │   │       │
│   │   │            (PB7 제어) ◀────────────────┴───── 1kΩ + 10kΩ PD    │   │       │
│   │   │                                                                 │   │       │
│   │   │      (사이드브러시 R은 PB14에서 동일 회로로 제어)               │   │       │
│   │   └─────────────────────────────────────────────────────────────────┘   │       │
│   │                                                                         │       │
│   └─────────────────────────────────────────────────────────────────────────┘       │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 AO3400 N-MOSFET 사양

| 파라미터 | 값 | 비고 |
|---------|---|------|
| VDS (max) | 30V | |
| ID (continuous) | 5.8A | 충분한 마진 |
| RDS(on) | 26mΩ @ VGS=4.5V | |
| VGS(th) | 0.65~1.4V | 3.3V 로직 호환 |
| 패키지 | SOT-23 | |
| 단가 | 50원 | |

---

## 4. UART1 메인보드 통신 (PA9/PA10)

### 4.1 통신 방식 선정

| 방식 | 거리 | 속도 | 노이즈 | 부품 | 선정 |
|-----|:----:|:----:|:-----:|------|:---:|
| **TTL (3.3V 직결)** | <30cm | 115.2kbps | 중 | 없음 | ⭐ |
| RS-232 | <15m | 115.2kbps | 중 | MAX232 | |
| RS-485 | <1200m | 10Mbps | 강 | SP485 | |

**선정: TTL 직결 (레벨 시프터 사용)**

이유:
- 메인보드(AP)와 모터 MCU 간 거리 < 10cm
- 동일 PCB 또는 FPC 케이블 연결
- 메인보드 AP가 3.3V 로직일 경우 직결 가능
- 메인보드 AP가 1.8V 로직일 경우 레벨 시프터 필요

### 4.2 회로도

```
                    UART1 메인보드 통신 회로 (PA9/PA10)
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                      │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                               │ │
│   │  CASE 1: 메인보드 AP가 3.3V 로직일 경우 (직결)                                │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   │       STM32F103                                   메인보드 AP                 │ │
│   │      (모터 MCU)                                 (Allwinner H6)                │ │
│   │                                                                               │ │
│   │   ┌─────────────┐                              ┌─────────────┐                │ │
│   │   │             │         33Ω                  │             │                │ │
│   │   │    PA9  ────┼────────/\/\/─────────────────┼──── UART_RX │                │ │
│   │   │   (TX)      │                              │             │                │ │
│   │   │             │         33Ω                  │             │                │ │
│   │   │    PA10 ◀───┼────────/\/\/─────────────────┼──── UART_TX │                │ │
│   │   │   (RX)      │                              │             │                │ │
│   │   │             │                              │             │                │ │
│   │   │    GND  ────┼──────────────────────────────┼──── GND     │                │ │
│   │   │             │                              │             │                │ │
│   │   └─────────────┘                              └─────────────┘                │ │
│   │                                                                               │ │
│   │   ※ 33Ω 직렬저항: 신호 반사 방지, ESD 보호 (옵션)                            │ │
│   │                                                                               │ │
│   └───────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                               │ │
│   │  CASE 2: 메인보드 AP가 1.8V 로직일 경우 (레벨 시프터 필요)                    │ │
│   │                                                                               │ │
│   │   ※ 레벨 시프터 IC: TXS0102 (2채널) 또는 TXB0102                             │ │
│   │                                                                               │ │
│   │       STM32F103                TXS0102                 메인보드 AP            │ │
│   │      (3.3V 로직)            (레벨 시프터)              (1.8V 로직)            │ │
│   │                                                                               │ │
│   │   ┌─────────────┐        ┌─────────────┐          ┌─────────────┐            │ │
│   │   │             │        │             │          │             │            │ │
│   │   │        3.3V ├────────┤ VCCA   VCCB ├──────────┤ 1.8V        │            │ │
│   │   │             │   │    │             │    │     │             │            │ │
│   │   │             │ ─┴─   │             │  ─┴─    │             │            │ │
│   │   │             │ 100nF  │             │  100nF   │             │            │ │
│   │   │             │ ─┬─   │             │  ─┬─    │             │            │ │
│   │   │             │   │    │             │    │     │             │            │ │
│   │   │    PA9  ────┼───┴────┤ A1       B1 ├────┴─────┼──── UART_RX │            │ │
│   │   │   (TX)      │        │             │          │             │            │ │
│   │   │             │        │             │          │             │            │ │
│   │   │    PA10 ◀───┼────────┤ A2       B2 ├──────────┼──── UART_TX │            │ │
│   │   │   (RX)      │        │             │          │             │            │ │
│   │   │             │        │             │          │             │            │ │
│   │   │    GND  ────┼────────┤ GND     GND ├──────────┼──── GND     │            │ │
│   │   │             │        │             │          │             │            │ │
│   │   └─────────────┘        └─────────────┘          └─────────────┘            │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   │           TXS0102 핀 배치 (DSBGA-8)                                          │ │
│   │                                                                               │ │
│   │                      ┌───────────┐                                           │ │
│   │               VCCA ──┤1        8├── VCCB                                     │ │
│   │                 A1 ──┤2        7├── B1                                       │ │
│   │                 A2 ──┤3        6├── B2                                       │ │
│   │                GND ──┤4        5├── OE (VCCB에 연결)                         │ │
│   │                      └───────────┘                                           │ │
│   │                                                                               │ │
│   └───────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
│                                                                                      │
│   UART1 설정:                                                                        │
│   ┌─────────────────────────────────────────────────────────────────────────────┐   │
│   │  • 통신 속도: 115200 bps (또는 921600 bps for 고속 통신)                    │   │
│   │  • 데이터 비트: 8                                                           │   │
│   │  • 정지 비트: 1                                                             │   │
│   │  • 패리티: None                                                             │   │
│   │  • 흐름 제어: None (또는 RTS/CTS 사용 시 PA11/PA12 할당)                    │   │
│   └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. UART3 디버그 (PB10/PB11)

### 5.1 통신 방식 선정

**선정: USB-UART 변환 (CP2102)**

디버그 포트는 개발/생산 테스트용이므로 PC와 연결하기 편한 USB-UART 변환을 사용합니다.

| 옵션 | IC | 속도 | 드라이버 | 단가 | 선정 |
|-----|----|----|---------|-----:|:---:|
| **USB-UART** | CP2102 | 921.6kbps | 내장 | 500원 | ⭐ |
| USB-UART | CH340G | 2Mbps | 필요 | 300원 | |
| USB-UART | FT232RL | 3Mbps | 내장 | 2,500원 | |

### 5.2 회로도

```
                    UART3 디버그 회로 (PB10/PB11)
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                      │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                               │ │
│   │  옵션 1: USB-UART 변환 IC 내장 (권장)                                         │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   │       STM32F103                    CP2102                    USB 커넥터       │ │
│   │      (모터 MCU)               (USB-UART 변환)                (Type-C/Micro)   │ │
│   │                                                                               │ │
│   │   ┌─────────────┐            ┌─────────────┐             ┌─────────────┐     │ │
│   │   │             │            │             │             │             │     │ │
│   │   │             │            │   VDD ──────┼─────────────┼── VBUS(5V)  │     │ │
│   │   │             │            │             │      │      │             │     │ │
│   │   │             │            │             │    ─┴─    │             │     │ │
│   │   │             │            │             │   100nF    │             │     │ │
│   │   │             │            │             │    ─┬─    │             │     │ │
│   │   │             │            │             │      │      │             │     │ │
│   │   │    PB10 ────┼────────────┤ RXD         │      │      │             │     │ │
│   │   │   (TX)      │            │             │             │             │     │ │
│   │   │             │            │   D+ ───────┼─────────────┼── D+        │     │ │
│   │   │    PB11 ◀───┼────────────┤ TXD         │             │             │     │ │
│   │   │   (RX)      │            │   D- ───────┼─────────────┼── D-        │     │ │
│   │   │             │            │             │             │             │     │ │
│   │   │             │            │   GND ──────┼─────────────┼── GND       │     │ │
│   │   │    GND  ────┼────────────┤ GND         │             │             │     │ │
│   │   │             │            │             │             │             │     │ │
│   │   │             │            │   DTR ──────┼──── (NC 또는 RST 연결)    │     │ │
│   │   │             │            │             │             │             │     │ │
│   │   └─────────────┘            └─────────────┘             └─────────────┘     │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   │           CP2102 회로 상세                                                    │ │
│   │                                                                               │ │
│   │                           ┌──────────────────────────┐                       │ │
│   │                           │         CP2102           │                       │ │
│   │                           │                          │                       │ │
│   │      USB VBUS ──┬─────────┤ VDD (pin 6)              │                       │ │
│   │                 │         │                          │                       │ │
│   │               ─┴─ 4.7μF  │                          │                       │ │
│   │               ─┬─        │ REGIN (pin 7) ───┬───────│──── 3.3V 출력 (선택)  │ │
│   │                 │         │                 │        │                       │ │
│   │                GND        │               ─┴─ 10μF │                       │ │
│   │                           │               ─┬─       │                       │ │
│   │                           │                 │        │                       │ │
│   │      USB D+ ──────────────┤ D+ (pin 4)     GND       │                       │ │
│   │                           │                          │                       │ │
│   │      USB D- ──────────────┤ D- (pin 3)              │                       │ │
│   │                           │                          │                       │ │
│   │      PB10 (TX) ───────────┤ RXD (pin 25)            │                       │ │
│   │                           │                          │                       │ │
│   │      PB11 (RX) ◀──────────┤ TXD (pin 26)            │                       │ │
│   │                           │                          │                       │ │
│   │                 ┌─────────┤ DTR (pin 27)            │                       │ │
│   │                 │         │                          │                       │ │
│   │      RST ◀──────┼─ 100nF ─┤ (Auto-reset 용, 선택)    │                       │ │
│   │                 │         │                          │                       │ │
│   │                GND        │ GND (pin 5) ─────────────│──── GND               │ │
│   │                           │                          │                       │ │
│   │                           └──────────────────────────┘                       │ │
│   │                                                                               │ │
│   └───────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                               │ │
│   │  옵션 2: 외부 USB-UART 어댑터 연결용 헤더 (저비용)                            │ │
│   │                                                                               │ │
│   │       STM32F103                     4-pin 헤더                                │ │
│   │      (모터 MCU)                    (2.54mm pitch)                             │ │
│   │                                                                               │ │
│   │   ┌─────────────┐                ┌──────────┐                                │ │
│   │   │             │       1kΩ      │  ○ GND   │  ← 외부 어댑터 연결            │ │
│   │   │    PB10 ────┼──────/\/\/─────┤  ○ TXD   │     (CP2102/CH340 모듈)        │ │
│   │   │   (TX)      │                │          │                                │ │
│   │   │             │       1kΩ      │  ○ RXD   │                                │ │
│   │   │    PB11 ◀───┼──────/\/\/─────┤  ○ 3.3V  │  ← 전원 공급 (선택)            │ │
│   │   │   (RX)      │                │          │                                │ │
│   │   │             │                └──────────┘                                │ │
│   │   │    GND  ────┼───────────────────┘                                        │ │
│   │   │             │                                                            │ │
│   │   └─────────────┘                                                            │ │
│   │                                                                               │ │
│   │   ※ 1kΩ 직렬저항: 3.3V/5V 혼용 시 보호                                       │ │
│   │   ※ 양산 시에는 테스트 패드로 대체 가능                                       │ │
│   │                                                                               │ │
│   └───────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
│   UART3 설정:                                                                        │
│   ┌─────────────────────────────────────────────────────────────────────────────┐   │
│   │  • 통신 속도: 115200 bps (디버그 표준)                                      │   │
│   │  • 데이터 비트: 8                                                           │   │
│   │  • 정지 비트: 1                                                             │   │
│   │  • 패리티: None                                                             │   │
│   │  • 용도: printf 디버그, 로그 출력, 펌웨어 업데이트                          │   │
│   └─────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 상태 LED (PC13)

### 6.1 부품 선정

PC13의 출력 전류가 제한적(최대 3mA 권장)이므로 **NPN 트랜지스터**를 사용하여 LED를 구동합니다.

| 부품 | 규격 | 역할 | 선정 이유 |
|-----|------|------|----------|
| **NPN TR** | 2N3904 또는 MMBT3904 | LED 스위칭 | 범용, 저가, SOT-23 |
| **LED** | 녹색 3mm, 20mA | 상태 표시 | 시인성 |
| **베이스 저항** | 10kΩ | TR 베이스 전류 제한 | 약 0.33mA 베이스 전류 |
| **LED 저항** | 150Ω | LED 전류 제한 | (3.3V-2V)/150Ω ≒ 8.7mA |

### 6.2 회로도

```
                         상태 LED 회로 (PC13)
┌──────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                      │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                               │ │
│   │   기본 회로 (NPN 트랜지스터 구동)                                             │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   │        3.3V                                                                   │ │
│   │         │                                                                     │ │
│   │         │                                                                     │ │
│   │    ┌────┴────┐                                                               │ │
│   │    │   R2    │  150Ω, 1/8W                                                   │ │
│   │    │  LED용  │  (LED 전류 제한)                                              │ │
│   │    └────┬────┘                                                               │ │
│   │         │                                                                     │ │
│   │         │                                                                     │ │
│   │    ┌────┴────┐                                                               │ │
│   │    │   LED   │  녹색 LED, Vf=2.0V, If=10mA                                   │ │
│   │    │    ▼    │                                                               │ │
│   │    └────┬────┘                                                               │ │
│   │         │                                                                     │ │
│   │         │ (Collector)                                                        │ │
│   │         │                                                                     │ │
│   │    ┌────┴────┐                                                               │ │
│   │    │    C    │                                                               │ │
│   │    │   /│    │   2N3904 / MMBT3904                                          │ │
│   │    │  / │    │   NPN 트랜지스터                                              │ │
│   │    │ ◁  │    │   SOT-23 패키지                                              │ │
│   │    │  \ │    │                                                               │ │
│   │    │   \│    │                                                               │ │
│   │    │    B    │                                                               │ │
│   │    │    │    │                                                               │ │
│   │    │    E    │                                                               │ │
│   │    └────┼────┘                                                               │ │
│   │         │                                                                     │ │
│   │         │ (Emitter)                                                          │ │
│   │        ─┴─                                                                   │ │
│   │        ///                                                                   │ │
│   │        GND                                                                   │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   │     PC13 (STM32F103)                                                         │ │
│   │         │                                                                     │ │
│   │         │                                                                     │ │
│   │    ┌────┴────┐                                                               │ │
│   │    │   R1    │  10kΩ, 1/8W                                                   │ │
│   │    │ 베이스  │  (베이스 전류 제한)                                           │ │
│   │    └────┬────┘                                                               │ │
│   │         │                                                                     │ │
│   │         │ (Base)                                                             │ │
│   │         │                                                                     │ │
│   │         └─────────────── (트랜지스터 베이스에 연결)                           │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   └───────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                               │ │
│   │   전체 회로도 (연결 상태)                                                     │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   │                            3.3V                                               │ │
│   │                             │                                                 │ │
│   │                             │                                                 │ │
│   │                        ┌────┴────┐                                           │ │
│   │                        │  150Ω   │                                           │ │
│   │                        └────┬────┘                                           │ │
│   │                             │                                                 │ │
│   │                        ┌────┴────┐                                           │ │
│   │                        │  ┌───┐  │                                           │ │
│   │                        │  │ ▼ │  │  LED (녹색)                               │ │
│   │                        │  └─┬─┘  │                                           │ │
│   │                        └────┼────┘                                           │ │
│   │                             │                                                 │ │
│   │                             │ C                                               │ │
│   │                           ┌─┴─┐                                              │ │
│   │                           │   │\                                              │ │
│   │         PC13 ────/\/\/────┤ B │ \                                            │ │
│   │                  10kΩ     │   │  ▷──── E ────┐                               │ │
│   │                           │   │ /            │                               │ │
│   │                           │   │/             │                               │ │
│   │                           └───┘             ─┴─                              │ │
│   │                          2N3904            ///                               │ │
│   │                                            GND                               │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   │   동작 원리:                                                                  │ │
│   │   ┌─────────────────────────────────────────────────────────────────────┐    │ │
│   │   │  PC13 = HIGH (3.3V)                                                 │    │ │
│   │   │    → 베이스 전류 = (3.3V - 0.7V) / 10kΩ ≒ 0.26mA                    │    │ │
│   │   │    → TR ON, LED ON                                                  │    │ │
│   │   │    → LED 전류 = (3.3V - 2.0V - 0.2V) / 150Ω ≒ 7.3mA                │    │ │
│   │   │                                                                     │    │ │
│   │   │  PC13 = LOW (0V)                                                    │    │ │
│   │   │    → 베이스 전류 = 0                                                │    │ │
│   │   │    → TR OFF, LED OFF                                                │    │ │
│   │   └─────────────────────────────────────────────────────────────────────┘    │ │
│   │                                                                               │ │
│   │                                                                               │ │
│   │   2N3904 / MMBT3904 핀 배치 (SOT-23)                                         │ │
│   │                                                                               │ │
│   │                      ┌─────────┐                                             │ │
│   │                    1 │ B     C │ 3                                           │ │
│   │                      │    ●    │                                             │ │
│   │                    2 │    E    │                                             │ │
│   │                      └─────────┘                                             │ │
│   │                                                                               │ │
│   │        Pin 1: Base (베이스)                                                  │ │
│   │        Pin 2: Emitter (이미터)                                               │ │
│   │        Pin 3: Collector (콜렉터)                                             │ │
│   │                                                                               │ │
│   └───────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
│                                                                                      │
│   ┌───────────────────────────────────────────────────────────────────────────────┐ │
│   │                                                                               │ │
│   │   LED 상태 패턴 예시 (펌웨어)                                                 │ │
│   │                                                                               │ │
│   │   ┌──────────────────────────────────────────────────────────────────────┐   │ │
│   │   │  상태              │  패턴                │  설명                    │   │ │
│   │   ├──────────────────────────────────────────────────────────────────────┤   │ │
│   │   │  대기              │  ━ ━ ━ ━ (1Hz)      │  느린 점멸               │   │ │
│   │   │  동작중            │  ━━━━━━━━ (상시)     │  상시 점등               │   │ │
│   │   │  에러              │  ━━━━ (2Hz)          │  빠른 점멸               │   │ │
│   │   │  충전중            │  ━ ━━ ━ ━━ (특수)   │  호흡 패턴               │   │ │
│   │   │  펌웨어 업데이트   │  ━━ ━━ ━━ (0.5Hz)   │  매우 느린 점멸          │   │ │
│   │   └──────────────────────────────────────────────────────────────────────┘   │ │
│   │                                                                               │ │
│   └───────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

---

## BOM 요약

### 모터 제어 MCU 주변 회로 BOM

| No | 부품명 | 규격 | 수량 | 단가 | 금액 | 비고 |
|:--:|-------|------|:---:|-----:|-----:|------|
| | **ADC 회로 (전류 감지)** | | | | | |
| 1 | 션트 저항 | 0.1Ω, 1W, 1% (2512) | 4 | 100원 | 400원 | |
| 2 | OP-AMP | LMV324 (Quad) | 1 | 400원 | 400원 | SOIC-14 |
| 3 | 저항 | 10kΩ, 0603 | 4 | 5원 | 20원 | |
| 4 | 저항 | 100kΩ, 0603 | 4 | 5원 | 20원 | |
| 5 | 저항 | 1kΩ, 0603 | 4 | 5원 | 20원 | |
| 6 | MLCC | 100nF, 0603 | 12 | 5원 | 60원 | |
| 7 | 다이오드 | BAV99 (Dual) | 4 | 20원 | 80원 | SOT-23 |
| | **소계** | | | | **1,000원** | |
| | **모터 드라이버** | | | | | |
| 8 | 모터 드라이버 IC | DRV8833 | 3 | 800원 | 2,400원 | HTSSOP-16 |
| 9 | N-MOSFET | AO3400 | 3 | 50원 | 150원 | SOT-23 |
| 10 | 쇼트키 다이오드 | SS34 | 3 | 30원 | 90원 | SMC |
| 11 | 전해 커패시터 | 100μF/25V | 3 | 50원 | 150원 | |
| 12 | MLCC | 100nF, 0603 | 6 | 5원 | 30원 | |
| 13 | 저항 | 10kΩ, 0603 | 6 | 5원 | 30원 | 풀업/풀다운 |
| 14 | 저항 | 1kΩ, 0603 | 4 | 5원 | 20원 | 게이트 저항 |
| | **소계** | | | | **2,870원** | |
| | **UART 통신** | | | | | |
| 15 | 레벨 시프터 | TXS0102 | 1 | 300원 | 300원 | DSBGA-8 (옵션) |
| 16 | USB-UART | CP2102 | 1 | 500원 | 500원 | QFN-28 (옵션) |
| 17 | USB 커넥터 | Type-C 또는 Micro | 1 | 150원 | 150원 | |
| 18 | 저항 | 33Ω, 0603 | 4 | 5원 | 20원 | 신호 보호 |
| 19 | MLCC | 100nF, 0603 | 4 | 5원 | 20원 | |
| 20 | 전해 커패시터 | 4.7μF/10V | 2 | 20원 | 40원 | |
| | **소계** | | | | **1,030원** | |
| | **LED 표시** | | | | | |
| 21 | NPN TR | MMBT3904 | 1 | 10원 | 10원 | SOT-23 |
| 22 | LED | 녹색 3mm | 1 | 30원 | 30원 | |
| 23 | 저항 | 10kΩ, 0603 | 1 | 5원 | 5원 | 베이스 저항 |
| 24 | 저항 | 150Ω, 0603 | 1 | 5원 | 5원 | LED 저항 |
| | **소계** | | | | **50원** | |
| | | | | **총계** | **4,950원** | |

---

## 📎 설계 요약

### 핀 할당 최종

| 핀 | 기능 | 연결 대상 | 비고 |
|---|------|----------|------|
| PA0 | ADC1_IN0 | 휠 모터 L 전류 | 0~3A → 0~3.3V |
| PA1 | ADC1_IN1 | 휠 모터 R 전류 | 0~3A → 0~3.3V |
| PA2 | ADC1_IN2 | 메인 브러시 전류 | 0~1.5A → 0~1.65V |
| PA3 | ADC1_IN3 | 물걸레 전류 | 0~1A → 0~1.1V |
| PA8 | TIM1_CH1 | DRV8833 #1 AIN1 | 휠L PWM |
| PA9 | USART1_TX | 메인보드 RX | TTL 3.3V |
| PA10 | USART1_RX | 메인보드 TX | TTL 3.3V |
| PA11 | TIM1_CH4 | DRV8833 #2 AIN2 | 휠R PWM |
| PB6 | TIM4_CH1 | DRV8833 #3 AIN1 | 브러시 PWM |
| PB7 | GPIO | AO3400 게이트 | 사이드브러시L |
| PB8 | TIM4_CH3 | DRV8833 #3 BIN1 | 물걸레L PWM |
| PB9 | TIM4_CH4 | AO3400 게이트 | 물걸레R PWM |
| PB10 | USART3_TX | CP2102 RXD | 디버그 TX |
| PB11 | USART3_RX | CP2102 TXD | 디버그 RX |
| PB12 | GPIO | DRV8833 #1 AIN2 | 휠L 방향 |
| PB13 | GPIO | DRV8833 #2 AIN1 | 휠R 방향 |
| PB14 | GPIO | AO3400 게이트 | 사이드브러시R |
| PC13 | GPIO | MMBT3904 베이스 | 상태 LED |

### 통신 인터페이스 요약

| 인터페이스 | 방식 | 속도 | 드라이버 | 용도 |
|-----------|------|------|---------|------|
| UART1 | TTL 3.3V 직결 | 115.2kbps | 없음 (레벨시프터 옵션) | 메인보드 통신 |
| UART3 | USB-UART | 115.2kbps | CP2102 | 디버그/로그 |

---

> **참고**: 본 회로는 개발 단계 기준이며, 양산 시 EMC 테스트 결과에 따라 필터 및 보호 회로가 추가될 수 있습니다.
